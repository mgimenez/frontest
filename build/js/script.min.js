!function(a){"use strict";function b(){var a=new XMLHttpRequest,b="../services/resources.json";a.onreadystatechange=function(){4==a.readyState&&200==a.status&&(m.dataResources=JSON.parse(a.responseText))},a.open("GET",b,!0),a.send()}function c(a,b){var c=Array.prototype.slice.call(b.children);return c.indexOf(a)}function d(){var b,c=0,d=0,f=a.querySelectorAll(".list-resources a"),g=a.querySelectorAll('.include-resources [type="checkbox"]:checked'),h=[];for(d;d<g.length;d++)b=e(g[d].getAttribute("value")),void 0!==b.css&&h.push(b.css),void 0!==b.js&&h.push(b.js);for(c;c<f.length;c++)h.push(f[c].href);return h}function e(a){return m.dataResources[a]}function f(){var a=0,b="",c="",e=d();for(a;a<e.length;a++)"css"===j(e[a])?b+='<link rel="stylesheet" href="'+e[a]+'"/>':"js"===j(e[a])&&(c+='<script src="'+e[a]+'"></script>');return{css:b,js:c}}function g(b,c,d){var e=a.createElement("li"),f=a.createElement("a"),g=a.createElement("span");f.setAttribute("href",c),f.setAttribute("target","_blank"),g.textContent="x",f.textContent=d,e.appendChild(f),e.appendChild(g),b.appendChild(e)}function h(a){var b=new RegExp("^(https?:\\/\\/)?((([a-z\\d]([a-z\\d-]*[a-z\\d])*)\\.)+[a-z]{2,}|((\\d{1,3}\\.){3}\\d{1,3}))(\\:\\d+)?(\\/[-a-z\\d%_.~+]*)*(\\?[;&a-z\\d%_.~+=-]*)?(\\#[-a-z\\d_]*)?$","i");if(b.test(a)){var c=a.split("/").pop(-1),d=new RegExp("(.*?).(js|css)$");return d.test(c)?!0:!1}return!1}function i(a){return a.split("/").pop(-1)}function j(a){return a.split(".").pop(-1)}function k(a,b){return b.indexOf(a)>-1}function l(b,c){ace.require("ace/ext/language_tools");var d=ace.edit(b);return d.setTheme("ace/theme/monokai"),d.getSession().setMode("ace/mode/"+c),d.setShowPrintMargin(!1),d.getSession().setUseWorker(!0),d.setOptions({enableBasicAutocompletion:!0,enableLiveAutocompletion:!0}),d.$blockScrolling=1/0,a.querySelector(".editor").addEventListener("resize",function(){alert(),d.resize()}),d}var m={},n="https://lh3.googleusercontent.com/vA40qEKfYIdcuE7jzvTWTMOfW1hR-R0Zf2v2nEnoQ0ksTY30Ush_em8b84QTMicyfr3hCg049Q=s128-h128-e365";window.addEventListener("load",function(d){b(),chrome.tabs.query({},function(a){for(var b=localStorage.getItem("tabId"),c=[],d=0;d<a.length;d++)c.push(a[d].id);k(parseInt(b),c)||localStorage.removeItem("tabId")});var j=l("editor-html","html"),o=l("editor-css","css"),p=l("editor-js","javascript"),q=a.querySelector(".panel"),r=a.querySelector(".btn-add-resource"),s=a.querySelector(".include-resources"),t=a.querySelector(".tabs"),u=[],v=[];chrome.storage.sync.get(function(b){if(b.editorHTML&&j.setValue(b.editorHTML,1),b.editorCSS&&o.setValue(b.editorCSS,1),b.editorJS&&p.setValue(b.editorJS,1),b.activeTab&&a.getElementById(b.activeTab).setAttribute("checked","checked"),b.resources){var c,d=a.querySelector(".list-resources"),e=0;for(e;e<b.resources.length;e++)c=b.resources[e],g(d,c,i(c)),u.push(c)}if(b.presetResources){var f,h,k=0,l=m.dataResources;for(k;k<b.presetResources.length;k++)for(f in l)for(h in l[f])b.presetResources[k]===l[f][h]&&(a.querySelector('.include-resources [value="'+f+'"]').setAttribute("checked","checked"),v.push(l[f][h]))}}),j.on("input",function(){chrome.storage.sync.set({editorHTML:j.getValue()})}),o.on("input",function(){chrome.storage.sync.set({editorCSS:o.getValue()})}),p.on("input",function(){chrome.storage.sync.set({editorJS:p.getValue()})}),q.addEventListener("submit",function(a){a.preventDefault();var b='data:text/html, <title>Frontest</title><link rel="icon" type="image/png" href="'+n+'">'+f().css+"<style>"+o.getValue()+"</style>"+j.getValue()+f().js+"<script>"+p.getValue()+"</script>";if(b=b.replace(/\n/g,"%0A%0D"),void 0===localStorage.tabId)chrome.tabs.create({url:b},function(a){localStorage.setItem("tabId",a.id)});else{var c=localStorage.getItem("tabId");chrome.tabs.update(parseInt(c),{url:b,selected:!0}),window.close()}}),chrome.tabs.onRemoved.addListener(function(a,b){localStorage.removeItem("tabId")}),s.addEventListener("change",function(b){var c=e(b.target.getAttribute("value")),d=0,f=a.querySelector("#include-jQuery");if(b.target.checked)void 0!==c.css&&v.push(c.css),void 0!==c.js&&v.push(c.js),"include-bootstrap"!==b.target.id||f.checked||a.querySelector("#include-jQuery").click();else for(d;d<v.length;d++)void 0!==c.css&&c.css===v[d]&&v.splice(d,1),void 0!==c.js&&c.js===v[d]&&v.splice(d,1);chrome.storage.sync.set({presetResources:v})}),r.addEventListener("click",function(b){b.preventDefault();var c=a.querySelector("#url-resource"),d=c.value,e=a.querySelector(".list-resources");h(d)?(c.classList.remove("error"),c.value="",g(e,d,i(d)),u.push(d),chrome.storage.sync.set({resources:u})):c.classList.add("error")}),a.querySelector(".list-resources").addEventListener("click",function(a){if("SPAN"===a.target.tagName){var b=c(a.target.parentElement,this);a.target.parentElement.remove(),-1!=b&&(u.splice(b,1),chrome.storage.sync.set({resources:u}))}}),a.querySelector(".icon-feedback").addEventListener("click",function(b){b.preventDefault();var c=a.querySelector(".content-feedback"),d=a.querySelector(".icon-feedback");c.classList.contains("active")?(c.classList.remove("active"),d.classList.remove("active")):(c.classList.add("active"),d.classList.add("active"))}),a.querySelector(".form-feedback").addEventListener("submit",function(b){b.preventDefault();var c=a.querySelector('[name="entry.430085320"]').value,d=a.querySelector(".thank-feedback"),e=new XMLHttpRequest;e.open("POST","https://docs.google.com/forms/d/1Q1MJW8D2ft1LmLt7JouuoZdJsfD2KT8YB4SR4_w4vGI/formResponse",!0),e.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),e.send("entry.430085320="+c),d.classList.add("active"),setTimeout(function(){a.querySelector(".content-feedback").classList.remove("active"),d.classList.remove("active")},2e3)}),t.addEventListener("change",function(b){var c=a.getElementById("editor-"+b.target.getAttribute("data-lang"));c.querySelector("textarea").focus(),chrome.storage.sync.set({activeTab:b.target.id})})}),window.app=m}(this.document);