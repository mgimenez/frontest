!function(a){"use strict";function b(){var a=new XMLHttpRequest,b="../services/resources.json";a.onreadystatechange=function(){4==a.readyState&&200==a.status&&(l.dataResources=JSON.parse(a.responseText))},a.open("GET",b,!0),a.send()}function c(a,b){var c=Array.prototype.slice.call(b.children);return c.indexOf(a)}function d(){var b,c=0,d=0,f=a.querySelectorAll(".list-resources a"),g=a.querySelectorAll('.include-resources [type="checkbox"]:checked'),h=[];for(d;d<g.length;d++)b=e(g[d].getAttribute("value")),void 0!==b.css&&h.push(b.css),void 0!==b.js&&h.push(b.js);for(c;c<f.length;c++)h.push(f[c].href);return h}function e(a){return l.dataResources[a]}function f(){var a=0,b="",c="",e=d();for(a;a<e.length;a++)"css"===j(e[a])?b+='<link rel="stylesheet" href="'+e[a]+'"/>':"js"===j(e[a])&&(c+='<script src="'+e[a]+'"></script>');return{css:b,js:c}}function g(b,c,d){var e=a.createElement("li"),f=a.createElement("a"),g=a.createElement("span");f.setAttribute("href",c),f.setAttribute("target","_blank"),g.textContent="x",f.textContent=d,e.appendChild(f),e.appendChild(g),b.appendChild(e)}function h(a){var b=new RegExp("^(https?:\\/\\/)?((([a-z\\d]([a-z\\d-]*[a-z\\d])*)\\.)+[a-z]{2,}|((\\d{1,3}\\.){3}\\d{1,3}))(\\:\\d+)?(\\/[-a-z\\d%_.~+]*)*(\\?[;&a-z\\d%_.~+=-]*)?(\\#[-a-z\\d_]*)?$","i");if(b.test(a)){var c=a.split("/").pop(-1),d=new RegExp("(.*?).(js|css)$");return d.test(c)?!0:!1}return!1}function i(a){return a.split("/").pop(-1)}function j(a){return a.split(".").pop(-1)}function k(a,b){ace.require("ace/ext/language_tools");var c=ace.edit(a);return c.setTheme("ace/theme/monokai"),c.getSession().setMode("ace/mode/"+b),c.getSession().setUseWorker(!0),c.setOptions({enableBasicAutocompletion:!0,enableLiveAutocompletion:!0}),c.$blockScrolling=1/0,c}var l={};window.addEventListener("load",function(d){b();var j=k("editor-html","html"),m=k("editor-css","css"),n=k("editor-js","javascript"),o=a.querySelector(".panel"),p=a.querySelector(".btn-add-resource"),q=a.querySelector(".include-resources"),r=a.querySelector(".tabs"),s=[],t=[];chrome.storage.sync.get(function(b){if(b.editorHTML&&j.setValue(b.editorHTML,1),b.editorCSS&&m.setValue(b.editorCSS,1),b.editorJS&&n.setValue(b.editorJS,1),b.activeTab&&a.getElementById(b.activeTab).setAttribute("checked","checked"),b.resources){var c,d=a.querySelector(".list-resources"),e=0;for(e;e<b.resources.length;e++)c=b.resources[e],g(d,c,i(c)),s.push(c)}if(b.presetResources){var f,h,k=0,o=l.dataResources;for(k;k<b.presetResources.length;k++)for(f in o)for(h in o[f])b.presetResources[k]===o[f][h]&&(a.querySelector('.include-resources [value="'+f+'"]').setAttribute("checked","checked"),t.push(o[f][h]))}}),j.on("input",function(){chrome.storage.sync.set({editorHTML:j.getValue()})}),m.on("input",function(){chrome.storage.sync.set({editorCSS:m.getValue()})}),n.on("input",function(){chrome.storage.sync.set({editorJS:n.getValue()})}),o.addEventListener("submit",function(a){a.preventDefault();var b="data:text/html, "+f().css+"<style>"+m.getValue()+"</style>"+j.getValue()+f().js+"<script>"+n.getValue()+"</script>";chrome.tabs.create({url:b})}),q.addEventListener("change",function(b){var c=e(b.target.getAttribute("value")),d=0,f=a.querySelector("#include-jQuery");if(b.target.checked)void 0!==c.css&&t.push(c.css),void 0!==c.js&&t.push(c.js),"include-bootstrap"!==b.target.id||f.checked||a.querySelector("#include-jQuery").click();else for(d;d<t.length;d++)void 0!==c.css&&c.css===t[d]&&t.splice(d,1),void 0!==c.js&&c.js===t[d]&&t.splice(d,1);console.log(t),chrome.storage.sync.set({presetResources:t})}),p.addEventListener("click",function(b){b.preventDefault();var c=a.querySelector("#url-resource"),d=c.value,e=a.querySelector(".list-resources");h(d)?(c.classList.remove("error"),c.value="",g(e,d,i(d)),s.push(d),chrome.storage.sync.set({resources:s})):c.classList.add("error")}),a.querySelector(".list-resources").addEventListener("click",function(a){if("SPAN"===a.target.tagName){var b=c(a.target.parentElement,this);a.target.parentElement.remove(),-1!=b&&(s.splice(b,1),chrome.storage.sync.set({resources:s}))}}),a.querySelector(".icon-feedback").addEventListener("click",function(b){b.preventDefault();var c=a.querySelector(".content-feedback"),d=a.querySelector(".icon-feedback");c.classList.contains("active")?(c.classList.remove("active"),d.classList.remove("active")):(c.classList.add("active"),d.classList.add("active"))}),a.querySelector(".form-feedback").addEventListener("submit",function(b){b.preventDefault();var c=a.querySelector('[name="entry.430085320"]').value,d=a.querySelector(".thank-feedback"),e=new XMLHttpRequest;e.open("POST","https://docs.google.com/forms/d/1Q1MJW8D2ft1LmLt7JouuoZdJsfD2KT8YB4SR4_w4vGI/formResponse",!0),e.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),e.send("entry.430085320="+c),d.classList.add("active"),setTimeout(function(){a.querySelector(".content-feedback").classList.remove("active"),d.classList.remove("active")},2e3)}),r.addEventListener("change",function(b){var c=a.getElementById("editor-"+b.target.getAttribute("data-lang"));c.querySelector("textarea").focus(),chrome.storage.sync.set({activeTab:b.target.id})})}),window.app=l}(this.document);